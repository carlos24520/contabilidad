<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Sistema Contable Pro</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<style>
body{background:#f4f6f9}
.card{border-radius:15px}
canvas{background:white;padding:15px;border-radius:10px}
</style>
</head>
<body class="container mt-4">

<h2 class="text-center mb-4">Sistema Contable Pro</h2>

<div class="card p-4 mb-4">
<div class="row">

<div class="col-md-2">
<label>Fecha</label>
<input type="date" id="fecha" class="form-control">
</div>

<div class="col-md-3">
<label>Cuenta</label>
<input type="text" id="cuenta" class="form-control" placeholder="Ej: Caja, Banco Estado, Proveedores...">
</div>

<div class="col-md-3">
<label>Glosa</label>
<input type="text" id="concepto" class="form-control">
</div>

<div class="col-md-2">
<label>Debe</label>
<input type="number" id="debe" class="form-control">
</div>

<div class="col-md-2">
<label>Haber</label>
<input type="number" id="haber" class="form-control">
</div>

<div class="col-md-3 mt-3">
<label>Clasificación</label>
<select id="clasificacion" class="form-select">
<option>Activo</option>
<option>Pasivo</option>
<option>Patrimonio</option>
<option>Costo</option>
<option>Gasto</option>
<option>Ingreso</option>
</select>
</div>

<div class="col-md-3 mt-4">
<button onclick="agregar()" class="btn btn-primary w-100">Agregar Movimiento</button>
</div>

<div class="col-md-3 mt-4">
<button onclick="guardar()" class="btn btn-success w-100">Guardar</button>
</div>

<div class="col-md-3 mt-4">
<button onclick="exportarExcel()" class="btn btn-warning w-100">Exportar Excel</button>
</div>

</div>
</div>

<!-- LIBRO DIARIO -->
<div class="card p-3 mb-4">
<h4>Libro Diario</h4>
<table class="table table-bordered">
<thead class="table-dark">
<tr>
<th>Fecha</th>
<th>Cuenta</th>
<th>Glosa</th>
<th>Debe</th>
<th>Haber</th>
<th>Eliminar</th>
</tr>
</thead>
<tbody id="tabla"></tbody>
</table>
</div>

<!-- LIBRO MAYOR T -->
<div class="card p-3 mb-4">
<h4>Libro Mayor (Formato T)</h4>
<div id="mayor"></div>
</div>

<!-- BALANCE -->
<div class="card p-3 mb-4">
<h4>Balance General</h4>
<div id="balance"></div>
</div>

<!-- GRAFICO -->
<div class="card p-3 mb-4">
<h4>Resumen Gráfico</h4>
<canvas id="grafico"></canvas>
</div>

<script>

let movimientos = JSON.parse(localStorage.getItem("movimientos")) || [];

function agregar(){
let fecha=document.getElementById("fecha").value;
let cuenta=document.getElementById("cuenta").value;
let concepto=document.getElementById("concepto").value;
let debe=parseFloat(document.getElementById("debe").value)||0;
let haber=parseFloat(document.getElementById("haber").value)||0;
let clasificacion=document.getElementById("clasificacion").value;

if(!fecha || !cuenta){alert("Complete los datos");return;}

movimientos.push({fecha,cuenta,concepto,debe,haber,clasificacion});
movimientos.sort((a,b)=>new Date(a.fecha)-new Date(b.fecha));

renderizar();
limpiar();
}

function limpiar(){
document.getElementById("fecha").value="";
document.getElementById("cuenta").value="";
document.getElementById("concepto").value="";
document.getElementById("debe").value="";
document.getElementById("haber").value="";
}

function eliminar(i){
movimientos.splice(i,1);
renderizar();
}

function guardar(){
localStorage.setItem("movimientos",JSON.stringify(movimientos));
alert("Datos guardados correctamente");
}

function renderizar(){
let tabla=document.getElementById("tabla");
tabla.innerHTML="";

movimientos.forEach((m,i)=>{
tabla.innerHTML+=`
<tr>
<td>${m.fecha}</td>
<td>${m.cuenta}</td>
<td>${m.concepto}</td>
<td>${m.debe}</td>
<td>${m.haber}</td>
<td><button onclick="eliminar(${i})" class="btn btn-danger btn-sm">X</button></td>
</tr>`;
});

calcularMayor();
calcularBalance();
grafico();
}

function calcularMayor(){
let mayor={};
movimientos.forEach(m=>{
if(!mayor[m.cuenta]) mayor[m.cuenta]={debe:0,haber:0};
mayor[m.cuenta].debe+=m.debe;
mayor[m.cuenta].haber+=m.haber;
});

let html="";
for(let cuenta in mayor){
html+=`
<div class="row mb-4">
<h5>${cuenta}</h5>
<div class="col-md-6 border p-2">
<b>Debe</b><br>${mayor[cuenta].debe}
</div>
<div class="col-md-6 border p-2">
<b>Haber</b><br>${mayor[cuenta].haber}
</div>
</div>`;
}
document.getElementById("mayor").innerHTML=html;
}

function calcularBalance(){
let totales={Activo:0,Pasivo:0,Patrimonio:0,Costo:0,Gasto:0,Ingreso:0};

movimientos.forEach(m=>{
totales[m.clasificacion]+=m.debe-m.haber;
});

document.getElementById("balance").innerHTML=`
Activo: ${totales.Activo}<br>
Pasivo: ${totales.Pasivo}<br>
Patrimonio: ${totales.Patrimonio}<br>
Costo: ${totales.Costo}<br>
Gasto: ${totales.Gasto}<br>
Ingreso: ${totales.Ingreso}
`;
}

function grafico(){
let totales={Activo:0,Pasivo:0,Patrimonio:0,Costo:0,Gasto:0,Ingreso:0};
movimientos.forEach(m=>{
totales[m.clasificacion]+=m.debe-m.haber;
});

new Chart(document.getElementById("grafico"),{
type:"bar",
data:{
labels:Object.keys(totales),
datasets:[{label:"Totales",data:Object.values(totales)}]
}
});
}

function exportarExcel(){
let ws=XLSX.utils.json_to_sheet(movimientos);
let wb=XLSX.utils.book_new();
XLSX.utils.book_append_sheet(wb,ws,"Libro Diario");
XLSX.writeFile(wb,"Libro_Diario.xlsx");
}

renderizar();

</script>

</body>
</html>